@use "sass:map";
@use "../../colors" as *;
@use "../../settings" as *;
@use "../../helpers/functions";
@use "theme-colors";
@use "../icons" as *;

@if map.get($modules, "themes/default") {
  /**
   * Styles
   */

  :root,
  :host {
    // Typography
    #{$css-var-prefix}font-family-emoji:
      "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", "Noto Color Emoji";
    #{$css-var-prefix}font-family-sans-serif:
      system-ui, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, Helvetica, Arial, "Helvetica Neue",
      sans-serif, var(#{$css-var-prefix}font-family-emoji);
    #{$css-var-prefix}font-family-monospace:
      ui-monospace, SFMono-Regular, "SF Mono", Menlo, Consolas, "Liberation Mono", monospace,
      var(#{$css-var-prefix}font-family-emoji);
    #{$css-var-prefix}font-family: var(#{$css-var-prefix}font-family-sans-serif);
    #{$css-var-prefix}line-height: 1.5;
    #{$css-var-prefix}font-weight: 400;
    #{$css-var-prefix}font-size: 100%;
    #{$css-var-prefix}text-underline-offset: 0.1rem;

    // Borders
    #{$css-var-prefix}border-radius: 0.25rem;
    #{$css-var-prefix}border-width: 0.0625rem;
    #{$css-var-prefix}outline-width: 0.125rem;

    // Transitions
    #{$css-var-prefix}transition: 0.2s ease-in-out;

    // Spacings
    #{$css-var-prefix}spacing: 1rem;

    // Spacings for typography elements
    @if map.get($modules, "content/typography") {
      #{$css-var-prefix}typography-spacing-vertical: 1rem;
    }

    // Spacings for body > header, body > main, body > footer, section, article
    @if map.get($modules, "layout/landmarks") or
      map.get($modules, "layout/section") or
      map.get($modules, "components/card") or
      map.get($modules, "components/modal")
    {
      #{$css-var-prefix}block-spacing-vertical: var(#{$css-var-prefix}spacing);
      #{$css-var-prefix}block-spacing-horizontal: var(#{$css-var-prefix}spacing);
    }

    @if map.get($modules, "layout/grid") and $enable-classes {
      #{$css-var-prefix}grid-column-gap: var(#{$css-var-prefix}spacing);
      #{$css-var-prefix}grid-row-gap: var(#{$css-var-prefix}spacing);
    }

    // Spacings for form elements and button
    @if map.get($modules, "content/button") or map.get($modules, "forms/basic") {
      #{$css-var-prefix}form-element-spacing-vertical: 0.75rem;
      #{$css-var-prefix}form-element-spacing-horizontal: 1rem;
    }

    // Font weight for form labels & fieldsets legend
    @if map.get($modules, "forms/basic") {
      #{$css-var-prefix}form-label-font-weight: var(#{$css-var-prefix}font-weight);
    }

    // Group (role="group")
    @if map.get($modules, "components/group") {
      #{$css-var-prefix}group-box-shadow: 0 0 0 rgba(0, 0, 0, 0);
      #{$css-var-prefix}group-box-shadow-focus-with-button: 0
        0
        0
        var(#{$css-var-prefix}outline-width)
        var(#{$css-var-prefix}primary-focus);
      #{$css-var-prefix}group-box-shadow-focus-with-input: 0
        0
        0
        0.0625rem
        var(#{$css-var-prefix}form-element-border-color);
    }

    // Modal (<dialog>)
    @if map.get($modules, "components/modal") {
      #{$css-var-prefix}modal-overlay-backdrop-filter: blur(0.375rem);
    }

    // Spacings for nav component
    @if map.get($modules, "components/nav") {
      #{$css-var-prefix}nav-element-spacing-vertical: 1rem;
      #{$css-var-prefix}nav-element-spacing-horizontal: 0.5rem;
      #{$css-var-prefix}nav-link-spacing-vertical: 0.5rem;
      #{$css-var-prefix}nav-link-spacing-horizontal: 0.5rem;
      #{$css-var-prefix}nav-breadcrumb-divider: ">";
    }

    // Checkboxes icons
    @if map.get($modules, "forms/checkbox-radio-switch") {
      #{$css-var-prefix}icon-checkbox: $icon-checkbox;
      #{$css-var-prefix}icon-minus: $icon-minus;
      #{$css-var-prefix}icon-color-scheme-light: $icon-color-scheme-light;
      #{$css-var-prefix}icon-color-scheme-dark: $icon-color-scheme-dark;
    }

    // Chevron icons
    @if map.get($modules, "forms/basics") or
      map.get($modules, "components/accordion") or
      map.get($modules, "components/dropdown")
    {
      #{$css-var-prefix}icon-chevron: $icon-chevron;
    }

    // Datetime icons
    @if map.get($modules, "forms/input-date") {
      #{$css-var-prefix}icon-date: $icon-date;
      #{$css-var-prefix}icon-time: $icon-time;
    }

    // Search icon
    @if map.get($modules, "forms/input-search") {
      #{$css-var-prefix}icon-search: $icon-search;
    }

    // Close icon
    @if map.get($modules, "components/modal") {
      #{$css-var-prefix}icon-close: $icon-close;
    }

    // Loading icon (animated)
    @if map.get($modules, "components/loading") {
      // Inspired by https://codepen.io/aleksander351/pen/KzgKPo
      #{$css-var-prefix}icon-loading: $icon-loading;
    }

    // Responsive root font size
    @if $enable-responsive-typography {
      @each $key, $values in $breakpoints {
        @if $values {
          @media (min-width: map.get($values, "breakpoint")) {
            #{$css-var-prefix}font-size: map.get($values, "root-font-size");
          }
        }
      }
    }
  }

  // Responsive spacings
  @if $enable-responsive-spacings {
    // Landmarks and section
    @if map.get($modules, "layout/landmarks") or map.get($modules, "layout/section") {
      #{$semantic-root-element} > header,
      #{$semantic-root-element} > main,
      #{$semantic-root-element} > footer,
      section {
        @each $key, $values in $breakpoints {
          @if $values {
            @media (min-width: map.get($values, "breakpoint")) {
              $multiplier: 1;
              @if $key == "sm" {
                $multiplier: 1.25;
              } @else if $key == "md" {
                $multiplier: 1.5;
              } @else if $key == "lg" {
                $multiplier: 1.75;
              } @else if $key == "xl" {
                $multiplier: 2;
              } @else if $key == "xxl" {
                $multiplier: 2.25;
              }

              #{$css-var-prefix}block-spacing-vertical: calc(
                var(#{$css-var-prefix}spacing) * $multiplier
              );
            }
          }
        }
      }
    }

    // Card (<article>)
    @if map.get($modules, "components/card") {
      article {
        @each $key, $values in $breakpoints {
          @if $values {
            @media (min-width: map.get($values, "breakpoint")) {
              $multiplier: 1;
              @if $key == "sm" {
                $multiplier: 1.25;
              } @else if $key == "md" {
                $multiplier: 1.5;
              } @else if $key == "lg" {
                $multiplier: 1.75;
              } @else if $key == "xl" {
                $multiplier: 2;
              } @else if $key == "xxl" {
                $multiplier: 2.25;
              }

              #{$css-var-prefix}block-spacing-vertical: calc(
                var(#{$css-var-prefix}spacing) * $multiplier
              );
              #{$css-var-prefix}block-spacing-horizontal: calc(
                var(#{$css-var-prefix}spacing) * $multiplier
              );
            }
          }
        }
      }
    }
  }

  // Link
  @if map.get($modules, "content/link") {
    a {
      #{$css-var-prefix}text-decoration: underline;

      // Secondary & Contrast
      @if $enable-classes {
        &.secondary,
        &.contrast {
          #{$css-var-prefix}text-decoration: underline;
        }
      }
    }
  }

  // Typography
  @if map.get($modules, "content/typography") {
    // Small
    small {
      #{$css-var-prefix}font-size: 0.875em;
    }

    // Headings
    h1,
    h2,
    h3,
    h4,
    h5,
    h6 {
      #{$css-var-prefix}font-weight: 700;
    }

    h1 {
      #{$css-var-prefix}font-size: 2rem;
      #{$css-var-prefix}line-height: 1.125;
      #{$css-var-prefix}typography-spacing-top: 3rem;
    }

    h2 {
      #{$css-var-prefix}font-size: 1.75rem;
      #{$css-var-prefix}line-height: 1.15;
      #{$css-var-prefix}typography-spacing-top: 2.625rem;
    }

    h3 {
      #{$css-var-prefix}font-size: 1.5rem;
      #{$css-var-prefix}line-height: 1.175;
      #{$css-var-prefix}typography-spacing-top: 2.25rem;
    }

    h4 {
      #{$css-var-prefix}font-size: 1.25rem;
      #{$css-var-prefix}line-height: 1.2;
      #{$css-var-prefix}typography-spacing-top: 1.874rem;
    }

    h5 {
      #{$css-var-prefix}font-size: 1.125rem;
      #{$css-var-prefix}line-height: 1.225;
      #{$css-var-prefix}typography-spacing-top: 1.6875rem;
    }

    h6 {
      #{$css-var-prefix}font-size: 1rem;
      #{$css-var-prefix}line-height: 1.25;
      #{$css-var-prefix}typography-spacing-top: 1.5rem;
    }
  }

  // Table
  @if map.get($modules, "content/table") {
    thead,
    tfoot {
      th,
      td {
        #{$css-var-prefix}font-weight: 600;
        #{$css-var-prefix}border-width: 0.1875rem;
      }
    }
  }

  // Code
  @if map.get($modules, "content/code") {
    pre,
    code,
    kbd,
    samp {
      #{$css-var-prefix}font-family: var(#{$css-var-prefix}font-family-monospace);
    }

    kbd {
      #{$css-var-prefix}font-weight: bolder;
    }
  }

  // Inputs and Selects
  input:not(
    [type="submit"],
    [type="button"],
    [type="reset"],
    [type="checkbox"],
    [type="radio"],
    [type="file"]
  ),
  :where(select, textarea) {
    #{$css-var-prefix}outline-width: 0.0625rem;
  }

  [type="search"] {
    #{$css-var-prefix}border-radius: 5rem;
  }

  // Checkboxes, Radios and Switches
  @if map.get($modules, "forms/checkbox-radio-switch") {
    [type="checkbox"],
    [type="radio"] {
      #{$css-var-prefix}border-width: 0.125rem;
    }

    [type="checkbox"][role="switch"] {
      #{$css-var-prefix}border-width: 0.1875rem;
    }
  }

  // Dropdown (details.dropdown)
  @if map.get($modules, "components/dropdown") and $enable-classes {
    details.dropdown {
      summary:not([role="button"]) {
        #{$css-var-prefix}outline-width: 0.0625rem;
      }
    }
    nav {
      details.dropdown {
        summary:focus-visible {
          #{$css-var-prefix}outline-width: 0.125rem;
        }
      }
    }
  }

  // Group (role="group")
  @if map.get($modules, "components/group") {
    [role="search"] {
      #{$css-var-prefix}border-radius: 5rem;
    }

    [role="search"],
    [role="group"] {
      @if $enable-classes {
        &:has(
          button.secondary:focus,
          [type="submit"].secondary:focus,
          [type="button"].secondary:focus,
          [role="button"].secondary:focus
        ) {
          #{$css-var-prefix}group-box-shadow-focus-with-button: 0
            0
            0
            var(#{$css-var-prefix}outline-width)
            var(#{$css-var-prefix}secondary-focus);
        }

        &:has(
          button.contrast:focus,
          [type="submit"].contrast:focus,
          [type="button"].contrast:focus,
          [role="button"].contrast:focus
        ) {
          #{$css-var-prefix}group-box-shadow-focus-with-button: 0
            0
            0
            var(#{$css-var-prefix}outline-width)
            var(#{$css-var-prefix}contrast-focus);
        }
      }

      button,
      [type="submit"],
      [type="button"],
      [role="button"] {
        #{$css-var-prefix}form-element-spacing-horizontal: 2rem;
      }
    }
  }

  // Chevron icons
  // Change the icon color to white for accordion and dropdown buttons
  @if map.get($modules, "components/accordion") or map.get($modules, "components/dropdown") {
    #{$parent-selector} details {
      summary {
        $selector: '&[role="button"]';
        @if $enable-classes {
          $selector: "#{$selector}:not(.outline)";
        }
        #{$selector} {
          &::after {
            filter: brightness(0) invert(1);
          }
        }
      }
    }
  }

  // Loading icon (animated)
  @if map.get($modules, "components/loading") {
    // Change the icon color to white for buttons
    #{$parent-selector} [aria-busy="true"]:not(input, select, textarea) {
      $selector: '&:is(button, [type="submit"], [type="button"], [type="reset"], [role="button"])';
      @if $enable-classes {
        $selector: "#{$selector}:not(.outline)";
      }
      #{$selector} {
        &::before {
          @if theme-colors.get("primary-inverse", "dark") == $white {
            filter: brightness(0) invert(1);
          } @else {
            filter: brightness(0) invert(0);
          }
        }
      }
    }
  }
}
